# Dockerfile for Nostr Collector
FROM node:20-slim

# Set working directory
WORKDIR /app

# Copy package files
COPY package*.json ./

# Install all dependencies (including devDependencies for tsx)
RUN npm ci

# Copy collector and server files
COPY collector ./collector
COPY server/db.ts ./server/db.ts

# Copy tsconfig if needed
COPY tsconfig.json ./

# Make run-loop.sh executable
RUN chmod +x /app/collector/run-loop.sh

# Run the collector in a loop
CMD ["/app/collector/run-loop.sh"]
